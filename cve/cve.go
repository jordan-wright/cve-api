package cve

import (
	"encoding/xml"
	"time"
)

type NVD struct {
	XMLName xml.Name `xml:"nvd" json:"-" sql:"-"`
	Entries []Entry  `xml:"entry" json:"entries"`
}

type Entry struct {
	XMLName          xml.Name    `xml:"entry" json:"-" sql:"-"`
	Id               int64       `xml:"-" json:"-"`
	CVEId            string      `xml:"id,attr" json:"id"`
	PublishedDate    time.Time   `xml:"published-datetime" json:"published_date"`
	LastModifiedDate time.Time   `xml:"last-modified-datetime" json:"last_modified_date"`
	CVSS             CVSS        `xml:"cvss>base_metrics" json:"cvss"`
	Products         []Product   `xml:"vulnerable-software-list>product" json:"products"`
	Summary          string      `xml:"summary" json:"summary"`
	References       []Reference `xml:"references" json:"references"`
}

type CVSS struct {
	Id                    int64     `xml:"-" json:"-"`
	EntryId               int64     `xml:"-" json:"-"`
	Score                 string    `xml:"score" json:"score"`
	AccessVector          string    `xml:"access-vector" json:"access_vector"`
	AccessComplexity      string    `xml:"access-complexity" json:"access_complexity"`
	Authentication        string    `xml:"authentication" json:"authentication"`
	ConfidentialityImpact string    `xml:"confidentiality-impact" json:"confidentiality_impact"`
	IntegrityImpact       string    `xml:"integrity-impact" json:"integrity_impact"`
	AvailabilityImpact    string    `xml:"availability-impact" json:"availability_impact"`
	Source                string    `xml:"source" json:"source"`
	GeneratedOnDate       time.Time `xml:"generated-on-datetime" json:"generated_on_date"`
}

type Reference struct {
	Id      int64  `xml:"-" json:"-"`
	EntryId int64  `xml:"-" json:"-"`
	Type    string `xml:"reference_type,attr" json:"type"`
	Source  string `xml:"source" json:"source"`
	Link    Link   `xml:"reference" json:"link"`
	LinkId  int64  `xml:"-" json:"-"`
}

//TableName is needed since "references" is a sqlite keyword.
func (r Reference) TableName() string {
	return "reference_list"
}

type Link struct {
	Id    int64  `xml:"-" json:"-"`
	Value string `xml:",chardata" json:"value"`
	Href  string `xml:"href,attr" json:"href"`
}

type Product struct {
	Id      int64 `xml:"-" json:"-"`
	EntryId int64 `xml:"-" json:"-"`
	Value   string
}
